# 8_内存管理

### 作用域
- 代码块作用域
- 函数作用域
- 文件作用域

malloc 可以分配内存     

```c
void func (int a, int b, int c )
{
    // Tips ：在这里，变量c是最先创建的，再创建了b，再创建了a；
}
/*
Tips：内存地址分配
栈内存，是从上到下存储的，先分配高地址，再分配低地址，

Tips：全局变量， 作用到整个项目当中，
要使用全局变量，需要在当前文件中进行声明；
extern int a;
*/
```

———————————————————————————————————————————————     
### 静态static局部变量
```c
int a1 = 10;
static int a2 = 10; // a2分配的内存区域只会分配一次，但是该内存区域可多次赋值；
```
```c
void func()
{   
    static int a  = 10;
    a++;
}
// 第一次调用func，a为10，func执行完之后a变为11；
// 第二次调用func，a为11，执行完之后为12；
// 不管使用多少次func，变量a所在的内存空间都只分配了一次，只是每次都给这块内存进行了读写；
```
```c
// static定义的变量只能在当前的文件中使用；
static int a1; 
```
```c
// 以下两种定义变量的方法是等价的
int a = 10;
auto signed int a = 10;
```
```c
extern int aa;      // 变量声明，该语句要放在文件的顶部

signed int aa = 10; // 变量定义，此时给变量分配了实际的内存空间

/*
Tips：
定义变量的时候自带声明，但是单独的声明需要置顶，
声明一般不写，如果要写则是放到头文件.h中；
*/
```
```c
extern int func2();
void main()
{

}
// func2如果放在 main 函数的下面，文件置顶要有func2的声明才能使用。
// func2如果放在 main 函数的上面，则无需对func2进行声明；
int func2()
{
    return 2;
}
```
-----------------------------------------------

### 各种变量的作用区域

| 变量定义 | 作用域  |
|---|---|
|局部变量 int a = 10         | 作用范围从变量定义到函数结束 |
|全局变量 int a = 10         | 作用范围为整个项目文件中     |
|static 局部变量 int a = 10  | 作用范围从变量定义到函数结束 |
|static 全局变量 int a = 10  | 作用范围为当前文件 |
|static void test()         | 作用范围为当前文件 |
|void test()                | 作用范围为整个项目文件中 |    
———————————————————————————————————————————————     
### 内存布局
```cmd
// size命令可以看到可执行文件各部分的相关信息
size xxx.exe
→ text data bss dec hex filename
```
```
可执行文件的组成

- text  代码区
- data  静态数据
- bss   未初始化数据区
- dec   十进制总和
- hex   十六进制总和
- filename
```
———————————————————————————————————————————————     
### 内存四区

- 代码区：存放程序指令

-----------------------------------------------    

- 数据区：有 静态区 和 全局区
```
①、初始化的数据
    1、初始化的全局变量
    2、静态全局变量
    3、静态局部变量

②、未初始化的数据
    1、静态局部变量，默认初值为0；
    2、全局变量，默认初值为0；
    3、静态全局变量，默认初值为0；

③、字符串常量
④、define定义的常量

Tips：代码区和数据区有一部分是两个区公用的；
```
-----------------------------------------------    

- 栈区

> Tips：栈区各个程序之间不公用，本程序私有；    
> 栈区向下增长，由高地址向低地址增长；   

> 栈区的大小，由OS给每一个程序分配 → 一个程序一个栈区；      
> 死循环、递归等会把栈区占满，因为多次调用会多次压栈；
```
一般的，windows 1~8M，linux 1~16M

栈区存放的有：局部变量、数组、结构体、指针、枚举类型、函数形参、常量；

注意：
1、C语言将数组放到栈区，而其他的语言一般是放到堆区；
2、C语言将常量放到栈区，而C++将常量放到数据区；

```
-----------------------------------------------    

- 堆区

> 有音频文件、视频文件、图像、文本、大的数据，都存放到堆区；    
> Tips：堆区理论上来说空间无限；

———————————————————————————————————————————————     
### 内存分配和释放
- malloc()
- free()

```c
// malloc开辟了一个1BYTE的空间，(char *)强制类型转换将这个空间指定为一个char类型
char *p = (char *)malloc(1); 

// ASCII的100是字符'd'
*p = 100;   
free(p);    // 使用完之后，释放p所指向的空间
```

———————————————————————————————————————————————     



———————————————————————————————————————————————     



———————————————————————————————————————————————     



———————————————————————————————————————————————     



———————————————————————————————————————————————     



———————————————————————————————————————————————     



———————————————————————————————————————————————     


